# net library
Документация в данный момент только на русском, так как библиотека находится в альфа разработке.
Примечание: Это не полная копия реального стека, здесь нет например CRC для проверки целосности пакетов, т.к. мод не нарушает содержимое пакетов(в данный момент), тоже самое и с флагами начала и конца слоя, здесь будет использоватся сериализация т.к. десеарилизация нативная и, следовательно, быстрая.

Всё взаимодействие происходит на порте `1`.

Термины:
- layer - слой [TCP/IP](https://ru.wikipedia.org/wiki/%D0%A1%D0%B5%D1%82%D0%B5%D0%B2%D0%B0%D1%8F_%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C_OSI) стека, хотя эталонным и считается [OSI](https://ru.wikipedia.org/wiki/%D0%A1%D0%B5%D1%82%D0%B5%D0%B2%D0%B0%D1%8F_%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C_OSI) стек, в реальности он соблюдается формально. Каждый стек в проэкте обозначается соим именем:
- drivers(OSI - L1) - физический уровень, предоставлен в моде "из коробки" в библиотеке реализованны "оболочки" для удобства. устройства - связанная карта, сетевая карта, беспроводная карта...(в теории возможно добавление своих устройств(полным эмулированием апи модема), но такие вещи как, например, корекцию ошибок реализуйте сами).
- LinkLayer(OSI - L2) - прослойка между драйверами и субмодулями(протоколами), имеет проверки на адрес отправи, адрес приема, существование протокола и наличие данных.
    - asvNetEthernet - Субмодуль, в библиотеке повторяет функции `send, broadcast` модуля `LinkLayer` за исключением что он вставляет свое имя в протокол, используется как транспорт для INet.

## подключение в коде:
`local net = require("asv").net`

## drivers
Уровень отвечающий за передачу данных,,  а также работу модема. Используется для прямой связи между устройствами.

Префикс модуля: `net.phys`
### `broadcastViaAll(...)`
Отправка сообщения через все сетевые адаптеры доступные адаптеры. (порт - по умолчанию)\
`...` - данные для отправки.

### `broadcast(srcAddr, ...)`
Отправка сообщения через указанный сетевой адаптер всем клиентам. (порт - по умолчанию)\
`srcAddr:string, nil` - Полный или частичный адрес адаптера. Если передан `nil` будет взято primary устройство.\
`...` - данные для отправки.

### `send(srcAddr, dstAddr, ...)`
Отправка сообщения через указанный сетевой адаптер на указанный узел. (порт - по умолчанию)\
`srcAddr:string, nil` - Полный или частичный адрес адаптера. Если передан `nil` будет взято primary устройство.\
`dstAddr:string` - Полный адрес принимающей стороны.\
`...` - данные для отправки.

## LinkLayer
Модуль является прослойкой между drivers и протоколами этого уровня, подготавливает данные для передачи через сеть.

Префикс модуля: `net.LL`

### `broadcast(srcAddr, protocol, data)`
Отправка сообщения через указанный сетевой адаптер всем клиентам. (порт - по умолчанию)\
`srcAddr:string, nil` - Полный или частичный адрес адаптера. Если передан `nil` данные отправятся через все интерфейсы, если передан "primary" будет взято primary устройство.\
`protocol:string` - имя протокола(этого уровня),
`data:boolean, number, string, table` - данные для отправки.

### `send(srcAddr, dstAddr, protocol, data)`
Отправка сообщения через указанный сетевой адаптер на указанный узел. (порт - по умолчанию)\
`srcAddr:string, nil` - Полный или частичный адрес адаптера. Если передан `nil` будет взято primary устройство.\
`dstAddr:string` - Полный адрес принимающей стороны.\
`protocol:string` - имя протокола(этого уровня),
`data:boolean, number, string, table` - данные для отправки.

#### Прием данных
После приема сообщения оно проверяется по следующим пунктам:
- Номер порта должен быть `1`(по умолчанию, определяется net.phys.service.port). 
- Тип поля данных должен быть `string`, для десериализации.
- "фрейм" должен содержать 2 поля, `protocol` и `data`, при нехватке - обработка прервется, лишние поля удалятся.

#### `asvNetEthernet`
Префикс модуля: `net.LL.protocols.asvNetEthernet`

##### `broadcast(srcAddr, data)`
Отправка сообщения через указанный сетевой адаптер всем клиентам.\
`srcAddr:string, nil` - Полный или частичный адрес адаптера. Если передан `nil` данные отправятся через все интерфейсы, если передан "primary" будет взято primary устройство.\
`data:boolean, number, string, table` - данные для отправки.

##### `send(srcAddr, dstAddr, data)`
Отправка сообщения через указанный сетевой адаптер на указанный узел.\
`srcAddr:string, nil` - Полный или частичный адрес адаптера. Если передан `nil` будет взято primary устройство.\
`dstAddr:string` - Полный адрес принимающей стороны.\
`data:boolean, number, string, table` - данные для отправки.

#### `arp`
Префикс модуля: `net.LL.protocols.arp`

##### `add(address, protocol, devAddr, timeout, data, canBeUsedToAnswer)`
Добавить адрес в таблицу кэша.
`address:string, number` - адрес который предполагается искать.
`protocol:string` - протокол для которого следует делать поиск.
`devAddr:string, nil` - Полный или частичный адрес адаптера. Если передан `nil` данные отправятся через все интерфейсы.
`timeout:number, nil` - адрес который предполагается искать.
`canBeUsedToAnswer:boolean, nil` - адрес который предполагается искать.

##### `remove(address, protocol)`
Удалить адрес из таблицы кэша.
`address:string, number` - адрес который предполагается искать.
`protocol:string` - протокол для которого следует делать поиск.
